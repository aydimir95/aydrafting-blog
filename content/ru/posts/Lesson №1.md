+++
title = "C# + Revit API: –£—Ä–æ–∫ 1 - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏—Å—Ç–æ–≤"
date = 2025-09-15T00:00:00+03:00
draft = false
tags = ["C#", "RevitAPI", "Tutorial"]
cover.image = "/images/Pasted image 20250915030857.png"
cover.alt = "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ (–¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö)"
+++

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –æ–±–µ—â–∞–Ω–∏–µ –∏–∑ [–£—Ä–æ–∫–∞ 0](http://blog.aydrafting.com/ru/posts/lesson-0/) ‚Äî —Å–æ–∑–¥–∞–¥–∏–º **—Ä–∞–±–æ—á—É—é –∫–æ–º–∞–Ω–¥—É**, –∫–æ—Ç–æ—Ä–∞—è:

- —Å–æ–∑–¥–∞—ë—Ç –ª–∏—Å—Ç (—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫)
- –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–∏—Å—Ç—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
- –≤—ã–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω—É—é —Å–≤–æ–¥–∫—É

> ‚úÖ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ó–∞–≤–µ—Ä—à–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É `Application` –∏–∑ –£—Ä–æ–∫–∞ 0. –ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –Ω–∞–¥–ø–∏—Å–µ–π, –∫–æ–º–∞–Ω–¥–∞ —É–≤–µ–¥–æ–º–∏—Ç –æ–± —ç—Ç–æ–º –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

---

# Application vs. Command

- **Application** (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å Revit): –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–∞—à –∞–¥–¥–∏–Ω ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø–∞–Ω–µ–ª–∏ –∏ –∫–Ω–æ–ø–∫–∏ –Ω–∞ –ª–µ–Ω—Ç–µ. –≠—Ç–æ ¬´**–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**¬ª.
- **Command** (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–∫–∏): –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ä–∞–±–æ—Ç—É ‚Äî —á–∏—Ç–∞–µ—Ç/–∏–∑–º–µ–Ω—è–µ—Ç –º–æ–¥–µ–ª—å. –≠—Ç–æ ¬´**–ª–æ–≥–∏–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞**¬ª.

–í –∫–æ–¥–µ —ç—Ç–∏ —Ä–æ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏:

| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è | –î–ª—è —á–µ–≥–æ | –ü—Ä–∏–º–µ—Ä—ã |
|---|---|---|---|
| `IExternalApplication` | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–∏ Revit | –î–æ–±–∞–≤–∏—Ç—å –ª–µ–Ω—Ç—É, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è | –î–æ–±–∞–≤–∏—Ç—å –ø–∞–Ω–µ–ª—å –∏ –∫–Ω–æ–ø–∫—É |
| `IExternalCommand` | –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É | –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É (read/modify model) | –°–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç—ã, —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤–∏–¥—ã |
| `IExternalDBApplication` | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–∏ (–±–µ–∑ UI) | –°–ª—É—à–∞—Ç—å DB-—Å–æ–±—ã—Ç–∏—è | Batch/monitoring, analytics |
| `IExternalCommandAvailability` | –ü–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π –∫–æ–º–∞–Ω–¥—ã | –í–∫–ª—é—á–∞—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é | –û—Ç–∫–ª—é—á–∞—Ç—å –±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ doc |
| `IExternalEventHandler` | –ü–æ –∑–∞–ø—Ä–æ—Å—É –∏–∑ modeless UI | –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ç—Ä–æ–≥–∞—Ç—å –º–æ–¥–µ–ª—å –∏–∑ UI/—Ñ–æ–Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ | Progress windows, async tasks |

> üß∞ `Nice3point.Revit.Toolkit` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã `ExternalApplication` –∏ `ExternalCommand`, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–æ—â–∞—é—Ç —ç—Ç–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã **—Ä–∞–±–æ—Ç–∞–µ–º —Å ¬´—á–∏—Å—Ç—ã–º¬ª `IExternalCommand`** –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—Å–Ω–æ–≤, –Ω–æ —Ç–∞–∫–∂–µ –ø–æ–∫–∞–∂–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ª–µ–Ω—Ç–æ–π —á–µ—Ä–µ–∑ Nice3point.

## –ü–æ—á–µ–º—É Revit —Ç—Ä–µ–±—É–µ—Ç `IExternal*` vs `External*` –∫–ª–∞—Å—Å—ã?

**–ö—Ä–∞—Ç–∫–æ:** Revit ‚Äî —Ö–æ—Å—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å—ã, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**. –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞: `IExternalApplication` (–∑–∞–ø—É—Å–∫/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ) –∏ `IExternalCommand` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã).

**–û—Ç–∫—É–¥–∞ `ExternalApplication` / `ExternalCommand` (–±–µ–∑ `I`)?**  
–≠—Ç–æ **–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã** –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Nice3point). –û–Ω–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —É–¥–æ–±–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ (`Document`, `UiDocument`), –¥–µ–ª–∞—è –∫–æ–¥ –ª–∞–∫–æ–Ω–∏—á–Ω–µ–µ. Revit –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏.

### –ú–æ–∂–Ω–æ –ª–∏ –¥–µ—Ä–∂–∞—Ç—å –æ–±–∞ –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ?

–û–±—ã—á–Ω–æ **–Ω–µ—Ç**. –õ—É—á—à–µ —Ä–∞–∑–¥–µ–ª—è—Ç—å –∏–∑-–∑–∞ —Ä–∞–∑–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤:
- `IExternalApplication`/`ExternalApplication` ‚Äî **–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é** Revit (—Å–æ–∑–¥–∞–Ω–∏–µ UI, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π)
- `IExternalCommand`/`ExternalCommand` ‚Äî **–ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–∞–∂–∞—Ç–∏–∏** –∫–Ω–æ–ø–∫–∏ (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø—Ä–∞–≤–∫–∏)

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω ‚Äî **–¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–∞** –≤ –æ–¥–Ω–æ–π —Å–±–æ—Ä–∫–µ:
```text
Test.Application                 ‚Üí IExternalApplication / ExternalApplication
Test.Commands.CreateSheetCommand ‚Üí IExternalCommand     / ExternalCommand
```

### –ö–∞–∫ Revit –Ω–∞—Ö–æ–¥–∏—Ç –≤–∞—à –∫–æ–¥ (`.addin` mapping)

Revit —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª **.addin**, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞—à—É —Å–±–æ—Ä–∫—É –∏ entry-class. –î–≤–∞ —Ç–∏–ø–æ–≤—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞:

**A) –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: Application-loader + –ª–µ–Ω—Ç–∞ (–æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å `.addin`)**

- –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å `<AddIn Type="Application">` –Ω–∞ –≤–∞—à Application-–∫–ª–∞—Å—Å.
- –í OnStartup —Å–æ–∑–¥–∞—ë—Ç–µ –ø–∞–Ω–µ–ª—å –ª–µ–Ω—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç–µ **push button**, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –≤–∞—à–µ–º—É –∫–ª–∞—Å—Å—É –∫–æ–º–∞–Ω–¥—ã.

```xml
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<RevitAddIns>
  <AddIn Type="Application">
    <Name>MyAddin</Name>
    <Assembly>C:\Path\To\MyAddin.dll</Assembly>
    <FullClassName>Test.Application</FullClassName>
    <VendorId>AYD</VendorId>
    <VendorDescription>AYDrafting</VendorDescription>
  </AddIn>
</RevitAddIns>
```

> –í Application.OnStartup() —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ –∫–Ω–æ–ø–∫—É –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:
> `new PushButtonData("CreateSheet", "Create Sheet", assemblyPath, "Test.Commands.CreateSheetCommand");`

**B) –¢–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥–∞ (–≤–∏–¥–Ω–∞ –≤ Add-Ins ‚Üí External Tools)**

‚Äî –ó–∞–ø–∏—Å—å `<AddIn Type="Command">`, —É–∫–∞–∑—ã–≤–∞—é—â–∞—è **–Ω–∞–ø—Ä—è–º—É—é** –Ω–∞ –∫–ª–∞—Å—Å –∫–æ–º–∞–Ω–¥—ã. –õ–µ–Ω—Ç—É –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

```xml
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<RevitAddIns>
  <AddIn Type="Command">
    <Name>CreateSheet</Name>
    <Assembly>C:\Path\To\MyAddin.dll</Assembly>
    <FullClassName>Test.Commands.CreateSheetCommand</FullClassName>
    <VendorId>AYD</VendorId>
    <VendorDescription>AYDrafting</VendorDescription>
  </AddIn>
</RevitAddIns>
```

### –ö–æ–≥–¥–∞ –∏ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –ù—É–∂–Ω–æ‚Ä¶                                      | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ                                                                  |
| ------------------------------------------- | ---------------------------------------------------------------------------- |
| –ö–Ω–æ–ø–∫–∞ –Ω–∞ –ª–µ–Ω—Ç–µ + –ª–æ–≥–∏–∫–∞ —Å—Ç–∞—Ä—Ç–∞             | `IExternalApplication`/`ExternalApplication` (—Å–æ–∑–¥–∞—Ç—å UI –∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏) |
| –î–µ–π—Å—Ç–≤–∏–µ –ø–æ –∫–ª–∏–∫—É, —á–∏—Ç–∞—é—â–µ–µ/–º–µ–Ω—è—é—â–µ–µ –º–æ–¥–µ–ª—å | `IExternalCommand`/`ExternalCommand` —Å transactions                          |
| –°–ª—É—à–∞—Ç–µ–ª–∏ DB-—Å–æ–±—ã—Ç–∏–π –±–µ–∑ UI                 | `IExternalDBApplication`                                                     |
| –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –∫–Ω–æ–ø–∫—É       | `IExternalCommandAvailability`                                               |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ –º–µ–Ω—è—Ç—å –º–æ–¥–µ–ª—å –∏–∑ modeless/async   | `IExternalEventHandler`                                                      |

**–ö–æ—Ä–æ—Ç–∫–æ:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `IExternal*` ‚Äî **–∫–æ–Ω—Ç—Ä–∞–∫—Ç**, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç Revit. –ö–ª–∞—Å—Å—ã `External*` —É–ø—Ä–æ—â–∞—é—Ç —Ä–∞–±–æ—Ç—É, –Ω–æ —Å–æ–±–ª—é–¥–∞—é—Ç —Ç–æ—Ç –∂–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç. **Application** (–∑–∞–ø—É—Å–∫ –∏ UI) –∏ **Command** (–ª–æ–≥–∏–∫–∞) –ª—É—á—à–µ **—Ä–∞–∑–¥–µ–ª—è—Ç—å** –∏ —Å–≤—è–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ª–µ–Ω—Ç—É.

---

# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **`CreateSheetCommand`**, –∫–æ—Ç–æ—Ä–∞—è:

1. –ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π `Document` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ Revit
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç `Transaction` —Å –∏–º–µ–Ω–µ–º "Create Sheet"
3. –ù–∞—Ö–æ–¥–∏—Ç —Ç–∏–ø –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–¥–ø–∏—Å–∏ (–Ω–µ —ç–∫–∑–µ–º–ø–ª—è—Ä!) –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π `ViewSheet`
4. –§–∏–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (`Commit`) –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
5. –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ª–∏—Å—Ç—ã –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç:
   - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤
   - –ø–µ—Ä–≤—ã–µ 5 –ª–∏—Å—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `–ù–æ–º–µ—Ä` - `–ù–∞–∑–≤–∞–Ω–∏–µ`
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ `TaskDialog`
7. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Result.Succeeded`; –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –æ—Ç–∫–∞—Ç —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

---

# –†–µ—à–µ–Ω–∏–µ

{{< collapse title="–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –ö–æ–¥" >}}

## `Project Solution`
```bash
Solution
|-> Test.csproj  
	|-> Commands
		|-> StartupCommand.cs  # –ò–∑–º–µ–Ω–∏—Ç—å
	|-> Resources
	|-> Application.cs  # –ò–∑–º–µ–Ω–∏—Ç—å
	|-> Test.addin
```



## `StartupCommand.cs` (–∫–æ–º–∞–Ω–¥–∞)
```C#
using Autodesk.Revit.Attributes;
using Autodesk.Revit.DB;
using Autodesk.Revit.UI;
using System;
using System.Collections.Generic;
using System.Linq;

namespace Test.Commands
{
    [Transaction(TransactionMode.Manual)]
    public class CreateSheetCommand : IExternalCommand
    {
        public Result Execute(
            ExternalCommandData commandData,
            ref string message,
            ElementSet elements)
        {
            // 1) –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç
            Document doc = commandData.Application.ActiveUIDocument.Document;

            string resultMessage = string.Empty;

            // 2) –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            using (Transaction transaction = new Transaction(doc, "Create Sheet"))
            {
                transaction.Start();

                try
                {
                    // –ù–∞–π—Ç–∏ —Ç–∏–ø –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–¥–ø–∏—Å–∏ (–Ω–µ —ç–∫–∑–µ–º–ø–ª—è—Ä)
                    ElementId titleBlockId = new FilteredElementCollector(doc)
                        .OfCategory(BuiltInCategory.OST_TitleBlocks)
                        .WhereElementIsElementType()
                        .FirstElementId();

                    // –°–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç
                    ViewSheet newSheet = ViewSheet.Create(doc, titleBlockId);
                    transaction.Commit();

                    resultMessage = $"‚úÖ –õ–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!\n–ù–æ–º–µ—Ä –ª–∏—Å—Ç–∞: {newSheet.SheetNumber}";
                }
                catch (InvalidOperationException)
                {
                    // –ù–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –Ω–∞–¥–ø–∏—Å–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ
                    transaction.RollBack();
                    resultMessage = "‚ùå –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–¥–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ.\n–í—Å—Ç–∞–≤–∫–∞ ‚Üí –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–º–µ–π—Å—Ç–≤–æ ‚Üí —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –Ω–∞–¥–ø–∏—Å—å.";
                }
                catch (Exception ex)
                {
                    // –õ—é–±–∞—è –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
                    transaction.RollBack();
                    resultMessage = $"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏—Å—Ç–∞: {ex.Message}";
                }
            }

            // 3) –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–∏—Å—Ç—ã
            var allSheets = new FilteredElementCollector(doc)
                .OfClass(typeof(ViewSheet))
                .Cast<ViewSheet>()
                .ToList();

            resultMessage += $"\n\nüìä –í—Å–µ–≥–æ –ª–∏—Å—Ç–æ–≤ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ: {allSheets.Count}";

            if (allSheets.Count > 0)
            {
                resultMessage += "\n\n–ü–µ—Ä–≤—ã–µ 5 –ª–∏—Å—Ç–æ–≤:";
                foreach (var sheet in allSheets.Take(5))
                {
                    resultMessage += $"\n‚Ä¢ {sheet.SheetNumber} - {sheet.Name}";
                }
            }

            // 4) –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
            TaskDialog.Show("–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏—Å—Ç–∞", resultMessage);
            return Result.Succeeded;
        }
    }
}
```

## `Application.cs` 
```csharp
using Nice3point.Revit.Toolkit.External;
using Test.Commands;

namespace Test
{
    /// <summary>
    ///     –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    /// </summary>
    [UsedImplicitly]
    public class Application : ExternalApplication
    {
        public override void OnStartup()
        {
            CreateRibbon();
        }

        private void CreateRibbon()
        {
            var panel = Application.CreatePanel("Commands", "Test");

            panel.AddPushButton<CreateSheetCommand>("Execute")
                .SetImage("/Test;component/Resources/Icons/RibbonIcon16.png")
                .SetLargeImage("/Test;component/Resources/Icons/RibbonIcon32.png");
        }
    }
}
```

> –ï—Å–ª–∏ –≤—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Nice3point, –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ —á–∏—Å—Ç—ã–π Revit API –≤ `IExternalApplication.OnStartup` –∏ —Å–≤—è–∂–∏—Ç–µ –µ—ë —Å `CreateSheetCommand` –≤ .addin. –ß–∏—Å—Ç—É—é –ª–µ–Ω—Ç—É —Ä–∞–∑–±–µ—Ä—ë–º –≤ –æ–¥–Ω–æ–º –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–∫–æ–≤.

## –†–µ–∑—É–ª—å—Ç–∞—Ç

![Pasted image 20250915031037.png](</images/Pasted image 20250915031037.png>)

---
{{< /collapse >}}

# –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ 

## 1) –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç

```csharp
[Transaction(TransactionMode.Manual)]
```

**–ü–æ—á–µ–º—É Manual?**
- –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: 
	- `Start()` - –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, 
	- `Commit()` - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, 
	- `RollBack()` - –û—Ç–º–µ–Ω–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. 
- –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥, **–∏–∑–º–µ–Ω—è—é—â–∏—Ö** –º–æ–¥–µ–ª—å, 

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã TransactionMode.Manual:
- `TransactionMode.ReadOnly` ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è/–∞–Ω–∞–ª–∏–∑–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª–∏)

## 2) –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ–º–∞–Ω–¥—ã

```C#
public class CreateSheetCommand : IExternalCommand
{
    public Result Execute(ExternalCommandData commandData, ref string message, ElementSet elements)
    {
        // ...
    }
}
```

- Revit **–≤—ã–∑—ã–≤–∞–µ—Ç** `Execute` –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
- –ú–µ—Ç–æ–¥ **–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç** `Result`: `Succeeded`, `Cancelled`, `Failed`
- –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: `commandData.Application.ActiveUIDocument.Document` ‚Üí –∞–∫—Ç–∏–≤–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç

## 3) –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å–µ—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `Transaction`:

```C#
using (var t = new Transaction(doc, "Something"))
{
    t.Start();
    try
    {
        // –∏–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å
        t.Commit();
    }
    catch
    {
        t.RollBack(); // –æ—Ç–º–µ–Ω–∞ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–µ
        throw;        // –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    }
}
```

## 4) –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

`FilteredElementCollector` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –º–æ–¥–µ–ª–∏:

```csharp
var titleBlockTypeId = new FilteredElementCollector(doc)
    .OfCategory(BuiltInCategory.OST_TitleBlocks)
    .WhereElementIsElementType() // —Ç–∏–ø—ã, –Ω–µ —Ä–∞–∑–º–µ—â—ë–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã
    .FirstElementId();           // –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
```

## 5) –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ [ViewSheet.Create](https://www.revitapidocs.com/2026/bc9e8be3-f3fd-97c2-2709-1d6eea3db775.htm)
 
```csharp
ViewSheet newSheet = ViewSheet.Create(doc, titleBlockTypeId);
```

–ë–µ–∑ —Ç–∏–ø–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–¥–ø–∏—Å–∏ Revit –Ω–µ —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç ‚Äî –ø–æ—ç—Ç–æ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º `InvalidOperationException`.

## 6) –û–±—â–µ–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

`TaskDialog` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Revit.

---

# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã ‚Äî –Ω–∞–≥–ª—è–¥–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è


`IExternalApplication` ‚Üí –∑–∞–ø—É—Å–∫/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —Å–æ–±—ã—Ç–∏–π
`IExternalCommand` ‚Üí –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ –∫–ª–∏–∫—É, –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏)
`IExternalDBApplication` ‚Üí —Ñ–æ–Ω–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (–±–µ–∑ UI), —Å–æ–±—ã—Ç–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
`IExternalEventHandler` ‚Üí –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–æ–¥–µ–ª—å—é
`IExternalCommandAvailability` ‚Üí —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –∫–æ–º–∞–Ω–¥ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É


### `IExternalCommand` vs. `ExternalCommand`
- –°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥:

**–û–±—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—ç—Ç–æ—Ç —É—Ä–æ–∫)**
```C#
public class MyCommand : IExternalCommand
{
    public Result Execute(ExternalCommandData c, ref string m, ElementSet e) 
    { 
	    /* ... */ 
    }
}
```

**–£–¥–æ–±–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å Nice3point**
```C#
public class MyCommand : ExternalCommand
{
    public override void Execute() 
    { 
	    /* Document, UiDocument –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∫ —Å–≤–æ–π—Å—Ç–≤–∞ */ 
	}
}
```

- `IExternalCommand` ‚Äî —ç—Ç–æ ¬´—á–∏—Å—Ç—ã–π¬ª –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Revit API. –¢—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å - –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `Execute()`, —Å–∞–º –¥–æ—Å—Ç–∞—ë—à—å UIApplication, UIDocument, Document –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç–∞–µ—à—å –Ω–∞–ø—Ä—è–º—É—é —Å API. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –¥–∞—ë—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–∞–∫ Revit –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–≤–æ–π –∫–æ–¥.
- `ExternalCommand` –æ—Ç Nice3point ‚Äî —ç—Ç–æ —É–¥–æ–±–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞. –û–Ω–∞ —É–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç `IExternalCommand` –∑–∞ —Ç–µ–±—è –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ (Document, UiDocument, Application), —É–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω–Ω—ã–π –∫–æ–¥ –∏ —É–ø—Ä–æ—â–∞–µ—Ç —Å—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞. –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º > –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π Revit API.

 > üìå **–í—ã–≤–æ–¥:** –†–∞–∑–Ω–∏—Ü–∞ —Ç–æ–ª—å–∫–æ –≤ —É—Ä–æ–≤–Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏: `ExternalCommand` ‚Äî —ç—Ç–æ ¬´—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä¬ª, –∞ `IExternalCommand` ‚Äî —á–∏—Å—Ç—ã–π API. –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –Ω–∞ –±–∞–∑–æ–≤–æ–º –∫–ª–∞—Å—Å–µ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏, –Ω–æ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏ –ø–æ–ª–µ–∑–Ω–æ –Ω–∞—á–∞—Ç—å —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

---

# –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**"–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–¥–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"**
- –í—Å—Ç–∞–≤–∫–∞ ‚Üí –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–º–µ–π—Å—Ç–≤–æ ‚Üí –¥–æ–±–∞–≤—å—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –Ω–∞–¥–ø–∏—Å—å (.rfa)
---
**–ö–Ω–æ–ø–∫–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .addin –∏ –ø–æ–ª–Ω–æ–µ –∏–º—è –∫–ª–∞—Å—Å–∞. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Nice3point —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ExternalApplication` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
---
**–û—à–∏–±–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
- –í—ã–∑—ã–≤–∞–π—Ç–µ `Start()` **–ø–µ—Ä–µ–¥** –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –º–æ–¥–µ–ª–∏, –∑–∞–≤–µ—Ä—à–∞–π—Ç–µ –∫–∞–∂–¥—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é `Commit()` –∏–ª–∏ `RollBack()`
---
**`ActiveUIDocument` —Ä–∞–≤–Ω–æ null**
- –ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –û—Ç–∫—Ä–æ–π—Ç–µ –º–æ–¥–µ–ª—å –≤ Revit


# –ß—Ç–æ –¥–∞–ª—å—à–µ

**–£—Ä–æ–∫ 2**: –û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (–±–∏—Ç—ã, –±–∞–π—Ç—ã, —Å–∏—Å—Ç–µ–º—ã —Å—á–∏—Å–ª–µ–Ω–∏—è –≤ C#)

**–î–∞–ª–µ–µ**: —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤–∏–¥–æ–≤ –Ω–∞ –ª–∏—Å—Ç–∞—Ö, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤, API –≤—ã–±–æ—Ä–∞ –∏ –Ω–µ–º–æ–¥–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å `IExternalEventHandler`

> –û—Å–æ–±–∞—è –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å [Aussie BIM Guru](https://www.youtube.com/@AussieBIMGuru) –∑–∞ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ Revit API.