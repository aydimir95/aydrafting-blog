<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>C# + Revit API: Lesson 1 — A Simple Walkthrough of the Command | Blog</title><meta name=keywords content="C#,Revit,Tutorial"><meta name=description content="This post explains one concrete command—line by line—so a beginner can follow without extra abstractions.
What this command does when you click your add-in button:


Tries to create a sheet (using an invalid title block on purpose → shows how error handling works).


Collects up to 10 existing sheets and formats their numbers/names.


Displays the result in a WPF dialog via a ViewModel.



✅ This article focuses only on the command. It assumes you’ve already wired a ribbon button (and .addin) that triggers StartupCommand."><meta name=author content><link rel=canonical href=https://blog.aydrafting.com/posts/post-1/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.aydrafting.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.aydrafting.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.aydrafting.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.aydrafting.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.aydrafting.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.aydrafting.com/posts/post-1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.aydrafting.com/posts/post-1/"><meta property="og:site_name" content="Blog"><meta property="og:title" content="C# + Revit API: Lesson 1 — A Simple Walkthrough of the Command"><meta property="og:description" content="This post explains one concrete command—line by line—so a beginner can follow without extra abstractions.
What this command does when you click your add-in button:
Tries to create a sheet (using an invalid title block on purpose → shows how error handling works).
Collects up to 10 existing sheets and formats their numbers/names.
Displays the result in a WPF dialog via a ViewModel.
✅ This article focuses only on the command. It assumes you’ve already wired a ribbon button (and .addin) that triggers StartupCommand."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-06T01:00:00+03:00"><meta property="article:modified_time" content="2025-08-06T01:00:00+03:00"><meta property="article:tag" content="C#"><meta property="article:tag" content="Revit"><meta property="article:tag" content="Tutorial"><meta property="og:image" content="https://blog.aydrafting.com/LogoAYD.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.aydrafting.com/LogoAYD.png"><meta name=twitter:title content="C# + Revit API: Lesson 1 — A Simple Walkthrough of the Command"><meta name=twitter:description content="This post explains one concrete command—line by line—so a beginner can follow without extra abstractions.
What this command does when you click your add-in button:


Tries to create a sheet (using an invalid title block on purpose → shows how error handling works).


Collects up to 10 existing sheets and formats their numbers/names.


Displays the result in a WPF dialog via a ViewModel.



✅ This article focuses only on the command. It assumes you’ve already wired a ribbon button (and .addin) that triggers StartupCommand."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.aydrafting.com/posts/"},{"@type":"ListItem","position":2,"name":"C# + Revit API: Lesson 1 — A Simple Walkthrough of the Command","item":"https://blog.aydrafting.com/posts/post-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"C# + Revit API: Lesson 1 — A Simple Walkthrough of the Command","name":"C# \u002b Revit API: Lesson 1 — A Simple Walkthrough of the Command","description":"This post explains one concrete command—line by line—so a beginner can follow without extra abstractions.\nWhat this command does when you click your add-in button:\nTries to create a sheet (using an invalid title block on purpose → shows how error handling works).\nCollects up to 10 existing sheets and formats their numbers/names.\nDisplays the result in a WPF dialog via a ViewModel.\n✅ This article focuses only on the command. It assumes you’ve already wired a ribbon button (and .addin) that triggers StartupCommand.\n","keywords":["C#","Revit","Tutorial"],"articleBody":"This post explains one concrete command—line by line—so a beginner can follow without extra abstractions.\nWhat this command does when you click your add-in button:\nTries to create a sheet (using an invalid title block on purpose → shows how error handling works).\nCollects up to 10 existing sheets and formats their numbers/names.\nDisplays the result in a WPF dialog via a ViewModel.\n✅ This article focuses only on the command. It assumes you’ve already wired a ribbon button (and .addin) that triggers StartupCommand.\nThe Command (Full Code) using Autodesk.Revit.Attributes; using Nice3point.Revit.Toolkit.External; using UKON.Views; using UKON.ViewModels; namespace UKON.Commands { /// /// External command entry point /// [UsedImplicitly] [Transaction(TransactionMode.Manual)] public class StartupCommand : ExternalCommand { public override void Execute() { var viewModel = Host.GetService(); var titleBlockId = ElementId.InvalidElementId; string resultMessage = \"\"; using (var transaction = new Transaction(Document, \"Create Sheet\")) { transaction.Start(); try { var sheet = ViewSheet.Create(Document, titleBlockId); transaction.Commit(); resultMessage = \"Sheet created successfully!\"; } catch (Autodesk.Revit.Exceptions.ArgumentException ex) { transaction.RollBack(); resultMessage = $\"Sheet could not be made: {ex.Message}\"; } catch (Exception ex) { transaction.RollBack(); resultMessage = $\"Error: {ex.Message}\"; } } // Get sheet information to display var allSheets = new FilteredElementCollector(Document). OfClass(typeof(ViewSheet)). ToElements(). ToList(); if (allSheets.Count \u003e 0) { var sheetNames = new List\u003cstring\u003e(); for (int i = 0; i \u003c Math.Min(10, allSheets.Count); i++) { var sheet = allSheets[i] as ViewSheet; sheetNames.Add($\"{sheet.SheetNumber} - {sheet.Name}\"); } resultMessage += $\"\\n\\nFound {allSheets.Count} sheets: \\n\" + string.Join(\"\\n\", sheetNames); } else { resultMessage += \"\\n\\nNo sheets found in document.\"; } viewModel.ResultMessage = resultMessage; var view = new UKONView(viewModel); view.ShowDialog(); } } } What Each Part Does (Beginner-Friendly) 1) Imports using Autodesk.Revit.Attributes; // [Transaction(...)] attribute using Nice3point.Revit.Toolkit.External; // ExternalCommand base + Host DI using UKON.Views; // WPF Window (UKONView) using UKON.ViewModels; // ViewModel (UKONViewModel) Revit attributes let you declare transaction behaviour.\nNice3point Toolkit provides a simplified ExternalCommand base (gives you Document) and DI access via Host.GetService().\nViews/ViewModels are your WPF MVVM types.\n2) Class \u0026 Attributes [UsedImplicitly] [Transaction(TransactionMode.Manual)] public class StartupCommand : ExternalCommand StartupCommand runs when the user clicks your button.\n[Transaction(TransactionMode.Manual)] = you start/commit/rollback changes.\nExternalCommand (Nice3point) simplifies the Revit command pattern.\nUsedImplicitly is an analyzer hint (e.g., JetBrains) so tooling doesn’t flag it as “unused.”\n3) Getting the ViewModel var viewModel = Host.GetService(); Pulls a ViewModel instance from DI so the dialog can display results via data binding. 4) Intentionally Invalid Title Block var titleBlockId = ElementId.InvalidElementId; // invalid on purpose string resultMessage = \"\"; We force a failure to demonstrate safe error handling.\nresultMessage will collect feedback for the user.\n5) Transaction + Error Handling Around ViewSheet.Create using (var transaction = new Transaction(Document, \"Create Sheet\")) { transaction.Start(); try { var sheet = ViewSheet.Create(Document, titleBlockId); transaction.Commit(); resultMessage = \"Sheet created successfully!\"; } catch (Autodesk.Revit.Exceptions.ArgumentException ex) { transaction.RollBack(); resultMessage = $\"Sheet could not be made: {ex.Message}\"; } catch (Exception ex) { transaction.RollBack(); resultMessage = $\"Error: {ex.Message}\"; } } Revit is read-only unless you’re inside a Transaction.\nCreating a sheet with an invalid title block throws ArgumentException → we rollback safely and show the message.\nAny unexpected error also triggers a rollback.\nThis is the core pattern you’ll reuse for any change in Revit: Start → Do work → Commit or RollBack on error.\n6) Collecting Existing Sheets var allSheets = new FilteredElementCollector(Document) .OfClass(typeof(ViewSheet)) .ToElements() .ToList(); Use FilteredElementCollector to find elements in the document.\nHere we collect all sheets.\nThen we format a short list for display:\nif (allSheets.Count \u003e 0) { var sheetNames = new List\u003cstring\u003e(); for (int i = 0; i \u003c Math.Min(10, allSheets.Count); i++) { var sheet = allSheets[i] as ViewSheet; sheetNames.Add($\"{sheet.SheetNumber} - {sheet.Name}\"); } resultMessage += $\"\\n\\nFound {allSheets.Count} sheets:\\n\" + string.Join(\"\\n\", sheetNames); } else { resultMessage += \"\\n\\nNo sheets found in document.\"; } We show up to 10 sheets as “A101 - Floor Plan”.\nIf there are none, we display that clearly.\n7) Show the Result in WPF viewModel.ResultMessage = resultMessage; var view = new UKONView(viewModel); view.ShowDialog(); Set the ViewModel property (MVVM). Open your WPF dialog to show the message. Why the Sheet Creation “Fails” (and How to Make It Succeed) It fails because we passed ElementId.InvalidElementId. To actually create a sheet, find a real title block type first:\nvar titleBlockId = new FilteredElementCollector(Document) .OfCategory(BuiltInCategory.OST_TitleBlocks) .WhereElementIsElementType() .FirstElementId(); // throws if none exist Replace the invalid id with this titleBlockId before ViewSheet.Create(…) and the command will create a sheet (assuming at least one title block type is loaded).\nOptional Cleanups (Beginner-Safe) Safer casting with LINQ: var sheets = new FilteredElementCollector(Document) .OfClass(typeof(ViewSheet)) .Cast() .ToList(); StringBuilder for long messages (not required, just tidy for larger outputs).\nKey Takeaways Always use a Transaction to modify the model.\nHandle exceptions and rollback on failure—never leave a transaction open.\nCollectors are how you find elements efficiently.\nMVVM + WPF: set data on the ViewModel; the dialog updates automatically.\nFor creating sheets, you need a valid title block type (OST_TitleBlocks).\n","wordCount":"803","inLanguage":"en","image":"https://blog.aydrafting.com/LogoAYD.png","datePublished":"2025-08-06T01:00:00+03:00","dateModified":"2025-08-06T01:00:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.aydrafting.com/posts/post-1/"},"publisher":{"@type":"Organization","name":"Blog","logo":{"@type":"ImageObject","url":"https://blog.aydrafting.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.aydrafting.com/ accesskey=h title="Blog (Alt + H)">Blog</a></div><div class="logo main-logo"><a href=https://aydrafting.com target=_blank><img src=/LogoAYD.png alt=Blog height=40></a></div><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.aydrafting.com/>Home</a>&nbsp;»&nbsp;<a href=https://blog.aydrafting.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">C# + Revit API: Lesson 1 — A Simple Walkthrough of the Command</h1><div class=post-meta><span title='2025-08-06 01:00:00 +0300 MSK'>August 6, 2025</span>&nbsp;·&nbsp;4 min&nbsp;|&nbsp;<a href=mailto:aydimir@aydrafting.com/posts/Post%20%e2%84%961.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-command-full-code aria-label="The Command (Full Code)">The Command (Full Code)</a></li><li><a href=#what-each-part-does-beginner-friendly aria-label="What Each Part Does (Beginner-Friendly)">What Each Part Does (Beginner-Friendly)</a><ul><li><a href=#1-imports aria-label="1) Imports">1) Imports</a></li><li><a href=#2-class--attributes aria-label="2) Class & Attributes">2) Class & Attributes</a></li><li><a href=#3-getting-the aria-label="3) Getting the ViewModel">3) Getting the ViewModel</a></li><li><a href=#4-intentionally-invalid-title-block aria-label="4) Intentionally Invalid Title Block">4) Intentionally Invalid Title Block</a></li><li><a href=#5-transaction--error-handling-around aria-label="5) Transaction + Error Handling Around ">5) Transaction + Error Handling Around </a></li><li><a href=#viewsheetcreate aria-label=ViewSheet.Create>ViewSheet.Create</a></li><li><a href=#6-collecting-existing-sheets aria-label="6) Collecting Existing Sheets">6) Collecting Existing Sheets</a></li><li><a href=#7-show-the-result-in-wpf aria-label="7) Show the Result in WPF">7) Show the Result in WPF</a></li></ul></li><li><a href=#why-the-sheet-creation-fails-and-how-to-make-it-succeed aria-label="Why the Sheet Creation “Fails” (and How to Make It Succeed)">Why the Sheet Creation “Fails” (and How to Make It Succeed)</a></li><li><a href=#optional-cleanups-beginner-safe aria-label="Optional Cleanups (Beginner-Safe)">Optional Cleanups (Beginner-Safe)</a></li><li><a href=#key-takeaways aria-label="Key Takeaways">Key Takeaways</a></li></ul></div></details></div><div class=post-content><p>This post explains <strong>one concrete command</strong>—line by line—so a beginner can follow without extra abstractions.</p><p><strong>What this command does when you click your add-in button:</strong></p><ol><li><p>Tries to create a <strong>sheet</strong> (using an <strong>invalid</strong> title block on purpose → shows how error handling works).</p></li><li><p>Collects up to <strong>10 existing sheets</strong> and formats their numbers/names.</p></li><li><p>Displays the result in a <strong>WPF dialog</strong> via a ViewModel.</p></li></ol><blockquote><p>✅ This article focuses only on the command. It assumes you’ve already wired a ribbon button (and .addin) that triggers StartupCommand.</p></blockquote><hr><h2 id=the-command-full-code><strong>The Command (Full Code)</strong><a hidden class=anchor aria-hidden=true href=#the-command-full-code>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>using</span> Autodesk.Revit.Attributes;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Nice3point.Revit.Toolkit.External;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> UKON.Views;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> UKON.ViewModels;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> UKON.Commands
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>/// &lt;summary&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///     External command entry point</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/// &lt;/summary&gt;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [UsedImplicitly]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [Transaction(TransactionMode.Manual)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StartupCommand</span> : ExternalCommand
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> Execute()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> viewModel = Host.GetService&lt;UKONViewModel&gt;();
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> titleBlockId = ElementId.InvalidElementId;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>string</span> resultMessage = <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> transaction = <span style=color:#66d9ef>new</span> Transaction(Document, <span style=color:#e6db74>&#34;Create Sheet&#34;</span>))
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                transaction.Start();
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>var</span> sheet = ViewSheet.Create(Document, titleBlockId);
</span></span><span style=display:flex><span>                    transaction.Commit();
</span></span><span style=display:flex><span>                    resultMessage = <span style=color:#e6db74>&#34;Sheet created successfully!&#34;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>catch</span> (Autodesk.Revit.Exceptions.ArgumentException ex)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    transaction.RollBack();
</span></span><span style=display:flex><span>                    resultMessage = <span style=color:#e6db74>$&#34;Sheet could not be made: {ex.Message}&#34;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>catch</span> (Exception ex)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    transaction.RollBack();
</span></span><span style=display:flex><span>                    resultMessage = <span style=color:#e6db74>$&#34;Error: {ex.Message}&#34;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Get sheet information to display</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> allSheets = <span style=color:#66d9ef>new</span> FilteredElementCollector(Document).
</span></span><span style=display:flex><span>					            OfClass(<span style=color:#66d9ef>typeof</span>(ViewSheet)).
</span></span><span style=display:flex><span>					            ToElements().
</span></span><span style=display:flex><span>					            ToList();
</span></span><span style=display:flex><span>				
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (allSheets.Count &gt; <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> sheetNames = <span style=color:#66d9ef>new</span> List&lt;<span style=color:#66d9ef>string</span>&gt;();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; Math.Min(<span style=color:#ae81ff>10</span>, allSheets.Count); i++)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>var</span> sheet = allSheets[i] <span style=color:#66d9ef>as</span> ViewSheet;
</span></span><span style=display:flex><span>                    sheetNames.Add(<span style=color:#e6db74>$&#34;{sheet.SheetNumber} - {sheet.Name}&#34;</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                resultMessage += <span style=color:#e6db74>$&#34;\n\nFound {allSheets.Count} sheets:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					               \n&#34;</span> + <span style=color:#66d9ef>string</span>.Join(<span style=color:#e6db74>&#34;\n&#34;</span>, sheetNames);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                resultMessage += <span style=color:#e6db74>&#34;\n\nNo sheets found in document.&#34;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            viewModel.ResultMessage = resultMessage;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> view = <span style=color:#66d9ef>new</span> UKONView(viewModel);
</span></span><span style=display:flex><span>            view.ShowDialog();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=what-each-part-does-beginner-friendly><strong>What Each Part Does (Beginner-Friendly)</strong><a hidden class=anchor aria-hidden=true href=#what-each-part-does-beginner-friendly>#</a></h2><h3 id=1-imports><strong>1) Imports</strong><a hidden class=anchor aria-hidden=true href=#1-imports>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>using</span> Autodesk.Revit.Attributes;         <span style=color:#75715e>// [Transaction(...)] attribute</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Nice3point.Revit.Toolkit.External; <span style=color:#75715e>// ExternalCommand base + Host DI</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> UKON.Views;                        <span style=color:#75715e>// WPF Window (UKONView)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> UKON.ViewModels;                   <span style=color:#75715e>// ViewModel (UKONViewModel)</span>
</span></span></code></pre></div><ul><li><p><strong>Revit attributes</strong> let you declare transaction behaviour.</p></li><li><p><strong>Nice3point Toolkit</strong> provides a simplified ExternalCommand base (gives you Document) and DI access via <code>Host.GetService&lt;T>().</code></p></li><li><p><strong>Views/ViewModels</strong> are your WPF MVVM types.</p></li></ul><hr><h3 id=2-class--attributes><strong>2) Class & Attributes</strong><a hidden class=anchor aria-hidden=true href=#2-class--attributes>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#a6e22e>[UsedImplicitly]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[Transaction(TransactionMode.Manual)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StartupCommand</span> : ExternalCommand
</span></span></code></pre></div><ul><li><p>StartupCommand runs <strong>when the user clicks</strong> your button.</p></li><li><p><code>[Transaction(TransactionMode.Manual)]</code> = <strong>you</strong> start/commit/rollback changes.</p></li><li><p>ExternalCommand (Nice3point) simplifies the Revit command pattern.</p></li></ul><blockquote><p>UsedImplicitly is an analyzer hint (e.g., JetBrains) so tooling doesn’t flag it as “unused.”</p></blockquote><hr><h3 id=3-getting-the><strong>3) Getting the <code>ViewModel</code></strong><a hidden class=anchor aria-hidden=true href=#3-getting-the>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>var</span> viewModel = Host.GetService&lt;UKONViewModel&gt;();
</span></span></code></pre></div><ul><li>Pulls a <strong>ViewModel instance</strong> from DI so the dialog can display results via data binding.</li></ul><hr><h3 id=4-intentionally-invalid-title-block><strong>4) Intentionally Invalid Title Block</strong><a hidden class=anchor aria-hidden=true href=#4-intentionally-invalid-title-block>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>var</span> titleBlockId = ElementId.InvalidElementId; <span style=color:#75715e>// invalid on purpose</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>string</span> resultMessage = <span style=color:#e6db74>&#34;&#34;</span>;
</span></span></code></pre></div><ul><li><p>We <strong>force a failure</strong> to demonstrate safe error handling.</p></li><li><p>resultMessage will collect feedback for the user.</p></li></ul><hr><h3 id=5-transaction--error-handling-around><strong>5) Transaction + Error Handling Around</strong> <a hidden class=anchor aria-hidden=true href=#5-transaction--error-handling-around>#</a></h3><h3 id=viewsheetcreate><code>ViewSheet.Create</code><a hidden class=anchor aria-hidden=true href=#viewsheetcreate>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> transaction = <span style=color:#66d9ef>new</span> Transaction(Document, <span style=color:#e6db74>&#34;Create Sheet&#34;</span>))
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    transaction.Start();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> sheet = ViewSheet.Create(Document, titleBlockId);
</span></span><span style=display:flex><span>        transaction.Commit();
</span></span><span style=display:flex><span>        resultMessage = <span style=color:#e6db74>&#34;Sheet created successfully!&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>catch</span> (Autodesk.Revit.Exceptions.ArgumentException ex)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        transaction.RollBack();
</span></span><span style=display:flex><span>        resultMessage = <span style=color:#e6db74>$&#34;Sheet could not be made: {ex.Message}&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>catch</span> (Exception ex)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        transaction.RollBack();
</span></span><span style=display:flex><span>        resultMessage = <span style=color:#e6db74>$&#34;Error: {ex.Message}&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><p><strong>Revit is read-only</strong> unless you’re inside a Transaction.</p></li><li><p>Creating a sheet with an invalid title block throws <strong>ArgumentException</strong> → we <strong>rollback</strong> safely and show the message.</p></li><li><p>Any unexpected error also triggers a rollback.</p></li></ul><blockquote><p>This is the core pattern you’ll reuse for <strong>any change</strong> in Revit: <em>Start → Do work → Commit or RollBack on error</em>.</p></blockquote><hr><h3 id=6-collecting-existing-sheets><strong>6) Collecting Existing Sheets</strong><a hidden class=anchor aria-hidden=true href=#6-collecting-existing-sheets>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>var</span> allSheets = <span style=color:#66d9ef>new</span> FilteredElementCollector(Document)
</span></span><span style=display:flex><span>				    .OfClass(<span style=color:#66d9ef>typeof</span>(ViewSheet))
</span></span><span style=display:flex><span>				    .ToElements()
</span></span><span style=display:flex><span>				    .ToList();
</span></span></code></pre></div><ul><li><p>Use FilteredElementCollector to <strong>find elements</strong> in the document.</p></li><li><p>Here we collect <strong>all sheets</strong>.</p></li></ul><p>Then we format a short list for display:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>if</span> (allSheets.Count &gt; <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> sheetNames = <span style=color:#66d9ef>new</span> List&lt;<span style=color:#66d9ef>string</span>&gt;();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; Math.Min(<span style=color:#ae81ff>10</span>, allSheets.Count); i++)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> sheet = allSheets[i] <span style=color:#66d9ef>as</span> ViewSheet;
</span></span><span style=display:flex><span>        sheetNames.Add(<span style=color:#e6db74>$&#34;{sheet.SheetNumber} - {sheet.Name}&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    resultMessage += <span style=color:#e6db74>$&#34;\n\nFound {allSheets.Count} sheets:\n&#34;</span> + <span style=color:#66d9ef>string</span>.Join(<span style=color:#e6db74>&#34;\n&#34;</span>, sheetNames);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    resultMessage += <span style=color:#e6db74>&#34;\n\nNo sheets found in document.&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><p>We show <strong>up to 10</strong> sheets as &ldquo;A101 - Floor Plan&rdquo;.</p></li><li><p>If there are none, we display that clearly.</p></li></ul><hr><h3 id=7-show-the-result-in-wpf><strong>7) Show the Result in WPF</strong><a hidden class=anchor aria-hidden=true href=#7-show-the-result-in-wpf>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span>viewModel.ResultMessage = resultMessage;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> view = <span style=color:#66d9ef>new</span> UKONView(viewModel);
</span></span><span style=display:flex><span>view.ShowDialog();
</span></span></code></pre></div><ul><li>Set the ViewModel <strong>property</strong> (MVVM).</li><li>Open your WPF <strong>dialog</strong> to show the message.</li></ul><hr><h2 id=why-the-sheet-creation-fails-and-how-to-make-it-succeed><strong>Why the Sheet Creation “Fails” (and How to Make It Succeed)</strong><a hidden class=anchor aria-hidden=true href=#why-the-sheet-creation-fails-and-how-to-make-it-succeed>#</a></h2><p>It fails because we passed <code>ElementId.InvalidElementId</code>. To actually create a sheet, find a <strong>real title block type</strong> first:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>var</span> titleBlockId = <span style=color:#66d9ef>new</span> FilteredElementCollector(Document)
</span></span><span style=display:flex><span>    .OfCategory(BuiltInCategory.OST_TitleBlocks)
</span></span><span style=display:flex><span>    .WhereElementIsElementType()
</span></span><span style=display:flex><span>    .FirstElementId(); <span style=color:#75715e>// throws if none exist</span>
</span></span></code></pre></div><blockquote><p>Replace the invalid id with this titleBlockId before ViewSheet.Create(&mldr;) and the command will create a sheet (assuming at least one title block type is loaded).</p></blockquote><hr><h2 id=optional-cleanups-beginner-safe><strong>Optional Cleanups (Beginner-Safe)</strong><a hidden class=anchor aria-hidden=true href=#optional-cleanups-beginner-safe>#</a></h2><ul><li><strong>Safer casting with LINQ</strong>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>var</span> sheets = <span style=color:#66d9ef>new</span> FilteredElementCollector(Document)
</span></span><span style=display:flex><span>    .OfClass(<span style=color:#66d9ef>typeof</span>(ViewSheet))
</span></span><span style=display:flex><span>    .Cast&lt;ViewSheet&gt;()
</span></span><span style=display:flex><span>    .ToList();
</span></span></code></pre></div><ul><li></li><li><p><strong>StringBuilder</strong> for long messages (not required, just tidy for larger outputs).</p></li></ul><hr><h2 id=key-takeaways><strong>Key Takeaways</strong><a hidden class=anchor aria-hidden=true href=#key-takeaways>#</a></h2><ul><li><p><strong>Always use a Transaction</strong> to modify the model.</p></li><li><p><strong>Handle exceptions</strong> and <strong>rollback</strong> on failure—never leave a transaction open.</p></li><li><p><strong>Collectors</strong> are how you <strong>find elements</strong> efficiently.</p></li><li><p><strong>MVVM + WPF</strong>: set data on the ViewModel; the dialog updates automatically.</p></li><li><p>For creating sheets, you need a <strong>valid title block type</strong> (<code>OST_TitleBlocks</code>).</p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.aydrafting.com/tags/c%23/>C#</a></li><li><a href=https://blog.aydrafting.com/tags/revit/>Revit</a></li><li><a href=https://blog.aydrafting.com/tags/tutorial/>Tutorial</a></li></ul><nav class=paginav><a class=prev href=https://blog.aydrafting.com/posts/post-2/><span class=title>« Prev</span><br><span>C# + Revit API: Lesson 2 - Bits & Bytes, ASCII Table, Pointers & Structs - Programming 101</span>
</a><a class=next href=https://blog.aydrafting.com/posts/post-0/><span class=title>Next »</span><br><span>C# + Revit API: Lesson 0</span></a></nav></footer></article></main><footer class=footer><span>© 2025 AYDrafting. All rights reserved.</span> ·
<span>Powered by
<a href=https://aydrafting.com/ rel="noopener noreferrer" target=_blank>AYDrafting</a> &
<a href=https://github.com/aydimir95/ rel=noopener target=_blank>GitHub</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>